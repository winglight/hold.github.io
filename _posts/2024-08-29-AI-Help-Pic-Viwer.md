# AI助我写代码（2）：图片浏览器

## 综述

* 起因是我在Mac上长期使用的Xee在macOS升级到13之后就没有更新，导致经常无法打开图片
* 我的要求很简单，就是可以在同一个目录下的图片之间跳转，图片可以自适应桌面大小
* 经过反复尝试，AI（ChatGPT-4o）可以很好的完成这种单一功能的桌面软件
* 把bug信息直接提交给AI，大部分情况下可以直接修复
* 如果全部代码包括bug修复都是AI生成，那么不需要每次生成时加上代码附件
* 代码开源仓库：[Pic-Viewer](https://github.com/winglight/Pic-Viewer)

## 操作视频（TODO）

## 需求
1. 支持双击图片文件或者菜单打开大部分常见格式的图片文件
2. 打开一张图片后，自动查找相同目录下的所有图片文件，并且可以通过空格或“J”导航打开下一张图片，使用“K”导航打开前一张图片
3. 如果图片长宽小于屏幕，以原始大小打开，如果超过屏幕分辨率，则自适应屏幕大小尽量显示最大尺寸的图片且完整显示
4. 窗口大小默认跟随图片大小，或者尽量占满屏幕，按“F”可以切换全屏显示
5. 打包成Mac上的可执行程序
   
## 操作步骤

1. 我已经总结好需求，所以提示词如下：
   ```
   使用python生成查看图片代码，有以下要求：
   1. 支持双击图片文件或者菜单打开大部分常见格式的图片文件
   2. 打开一张图片后，自动查找相同目录下的所有图片文件，并且可以通过空格或“J”导航打开下一张图片，使用“K”导航打开前一张图片
   3. 如果图片长宽小于屏幕，以原始大小打开，如果超过屏幕分辨率，则自适应屏幕大小尽量显示最大尺寸的图片且完整显示
   4. 窗口大小默认跟随图片大小，或者尽量占满屏幕，按“F”可以切换全屏显示
   5. 打包成Mac上的可执行程序
   ```
2. 复制代码到本地运行报错，而且我也没看懂什么错误，直接发给AI看看，提示词如下：
   ```
   运行python主程序报错：*** Terminating app due to uncaught exception 'NSInvalidArgumentException', reason: '-[SDLApplication macOSVersion]: unrecognized selector sent to instance 0x141033910'
   ```
   AI的回复让我意识到，应该限制AI生成代码时使用的GUI框架，比如：TK
3. 这次倒是没问题，可以运行，然而有新的问题，提示词如下：
   ```
   运行程序后，打开文件选择框时，无法选择任何图片文件，可能是没有Mac用户目录的权限，要如何解决
   ```
   这次是Mac上的特有问题，应该是有成熟的解决方案
4. 再次运行，出现了新的bug，提示词如下：
   ```
   修改bug：图片打开需要保持原图的长宽比
   ```
5. 这次没有bug，但是我想增加新的功能，提示词如下：
   ```
   修改：在窗口标题栏显示当前图片是第几张图/全部图片数量，以及文件名
   ```
6. 发现了新的bug，提示词如下：
   ```
   修改bug：打开浏览窗口时要居中显示
   ```
7. 功能基本都实现了，这次我想打包成可以放到Mac应用程序中的程序，然而AI提供的方案有问题，提示词如下：
   ```
   使用：python setup.py py2app，打包时报错：RecursionError: maximum recursion depth exceeded while calling a Python object
   ```
8. 经过跟AI的反复尝试，最终发现py2app这个方案不行，我自行改成了pyinstaller（这里需要自行寻找成熟方案），提示词如下：
   ```
   使用pyinstaller打包时，生成的main程序可以运行，但是无法通过在finder中双击图片文件后选择main程序来打开图片文件，解决这个不能接收文件的问题
   ```
9. 又经过几轮尝试，打包没问题了，我又想增加新的功能，提示词如下：
   ```
   以上程序支持触摸板或者鼠标的放大缩小
   ```
10. 我发现触摸板上的手势不支持，于是继续修改，提示词如下：
   ```
   支持pinch手势来无级缩放
   ```
   此时，AI提示TK并不支持pinch手势，必需改为QT
   
11. 然而运行后，报错，提示词如下：
   ```
   报错：Traceback (most recent call last):
  File "/Users/chenyu/work/opensource/Pic-Viewer/PicViewer-Qt.py", line 76, in event
    if event.type() == Qt.Gesture:
   AttributeError: type object 'Qt' has no attribute 'Gesture'
   ```
12. 使用QT之后产生更多新的问题，提示词如下：
   ```
   比tk的版本，少了窗口大小、按键导航的功能，请加入之前版本的全部功能
   ```
13. QT产生了越来越多新的问题，到最后我只是勉强让QT版尽量贴近TK的实现，但是还有几个小问题没有完全解决，所以我个人还是选择使用TK版